{"ast":null,"code":"import _toConsumableArray from\"C:\\\\Users\\\\Skaidrius\\\\Downloads\\\\ragemppro_dednet\\\\STATE-RAGE-UI-master-fixed\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"C:\\\\Users\\\\Skaidrius\\\\Downloads\\\\ragemppro_dednet\\\\STATE-RAGE-UI-master-fixed\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"C:\\\\Users\\\\Skaidrius\\\\Downloads\\\\ragemppro_dednet\\\\STATE-RAGE-UI-master-fixed\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\Skaidrius\\\\Downloads\\\\ragemppro_dednet\\\\STATE-RAGE-UI-master-fixed\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\Skaidrius\\\\Downloads\\\\ragemppro_dednet\\\\STATE-RAGE-UI-master-fixed\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\Skaidrius\\\\Downloads\\\\ragemppro_dednet\\\\STATE-RAGE-UI-master-fixed\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React from'react';import MaterialIcon from'material-icons-react';import Avatar from'@material-ui/core/Avatar';var Chat=/*#__PURE__*/function(_React$Component){_inherits(Chat,_React$Component);var _super=_createSuper(Chat);function Chat(props){var _this;_classCallCheck(this,Chat);_this=_super.call(this,props);_this.handleKeyPress=function(event){if(event.key==='Enter'){_this.sendMessage();}};_this.state={text:'',message_timeout:false,render:false};return _this;}_createClass(Chat,[{key:\"componentDidCatch\",value:function componentDidCatch(error,errorInfo){mp.trigger('client:ui:debug','Chat.jsx',error,errorInfo);// eslint-disable-line\n}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProp,prevState){if(this.props.data!==prevProp.data){this.updateChat();window.scrollTo(0,document.body.scrollHeight);}}},{key:\"componentWillMount\",value:function componentWillMount(){document.addEventListener(\"keydown\",this.handleKeyPress);this.updateChat();window.scrollTo(0,document.body.scrollHeight);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){document.removeEventListener(\"keydown\",this.handleKeyPress);this.setState({chat:{},render:false,contact:null});}},{key:\"updateChat\",value:function updateChat(){var _this2=this;var chat=null;this.props.data.forEach(function(e){if(e.phone_number===_this2.props.messenger.current_chat){chat=e;}});if(chat!=null){this.setState({chat:chat,render:true,contact:this.props.getContactByNumber(chat.phone_number)},function(){return _this2.setState(function(prevState){return _objectSpread({},prevState.chat.message=_toConsumableArray(_this2.state.chat.message).sort(function(a,b){if(a.date===b.date){return b.time>a.time;}return a.date<b.date?1:-1;}));});});}else{this.setState({chat:{phone_number:this.props.messenger.current_chat,is_online:false,// был(а) в сети 12.01.2019\nlast_login:'',message:[]},render:true,contact:this.props.getContactByNumber(this.props.messenger.current_chat)});}}},{key:\"inputChange\",value:function inputChange(message){if(message.target.value.toString().length>=500)return;// Макс длинна сообщения 600 символов\nthis.setState({text:message.target.value});}},{key:\"inputFocus\",value:function inputFocus(focus){try{mp.trigger('client:phone:inputModal',true);// eslint-disable-line\n}catch(e){}}},{key:\"inputBlur\",value:function inputBlur(focus){try{mp.trigger('client:phone:inputModal',false);// eslint-disable-line\n}catch(e){}}},{key:\"sendMessage\",value:function sendMessage(){var _this3=this;if(this.state.message_timeout)return;// Нельзя отправлять сообщения так часто\nthis.setState({message_timeout:true});setTimeout(function(){this.setState({message_timeout:false});}.bind(this),1000);// 1 секунда таймаут на отправку сообщения\nif(this.state.text.length>=500)this.setState({text:this.state.text.substr(0,500)});// Макс длинна сообщения 500 символов\nif(this.state.text===\"\")return;var text=this.state.text;this.setState(function(prev){return _objectSpread({},prev.chat.message=[{type:2,text:text,time:_this3.props.time,date:_this3.props.date}].concat(_this3.state.chat.message));},function(){_this3.props.sendMessage(_this3.props.messenger.current_chat,_this3.state.chat,text);try{mp.trigger('client:phone:sendMessage',_this3.props.messenger.current_chat,_this3.state.chat,text);// eslint-disable-line\n}catch(e){}});this.setState({text:''});}},{key:\"render\",value:function render(){var _this4=this;if(!this.state.render)return null;return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"dedbit-menu\"},/*#__PURE__*/React.createElement(\"div\",{className:\"u-title\",style:{height:50+'px'}},/*#__PURE__*/React.createElement(\"div\",{className:\"dedbit-u-texttittle\"},/*#__PURE__*/React.createElement(\"img\",{src:\"https://state-99.com/client/images/icons/components/phone/img/back.svg\",className:\"u__back-nabs\",height:\"16\",onClick:function onClick(){return _this4.props.setLink(\"/phone/android/messenger\");}}),this.state.contact===null?null:/*#__PURE__*/React.createElement(\"span\",{className:\"dedbit__messenger__chatname\"},this.state.contact.name.substring(0,1)),/*#__PURE__*/React.createElement(\"div\",{className:\"u-title-row spiceal-ts-chat\"},/*#__PURE__*/React.createElement(\"div\",{className:\"dedbit-title-name\"},this.state.contact!==null?this.state.contact.name:this.state.chat.phone_number),/*#__PURE__*/React.createElement(\"div\",{className:\"dedbit-title-text\"},this.state.chat.online)),/*#__PURE__*/React.createElement(\"div\",{className:\"posit-icon-del-chat\",onClick:function onClick(){return _this4.props.deleteChat(_this4.state.chat.phone_number);}/* this.props.openModal('','Вы уверены в том что хотите удалить всю переписку?', ['Да','Нет'], 'params') */},/*#__PURE__*/React.createElement(MaterialIcon,{icon:\"delete\",size:18,color:\"#fff\"})))),/*#__PURE__*/React.createElement(\"div\",{className:\"messenger-main clm-reverse-chat\"},this.state.chat.message.map(function(e,i){var index=\"dedchat\".concat(i);return/*#__PURE__*/React.createElement(React.Fragment,{key:index},e.type===1?/*#__PURE__*/React.createElement(\"div\",{className:\"ded-messenge\"},/*#__PURE__*/React.createElement(\"div\",{className:\"testmes ded-vxod\"},/*#__PURE__*/React.createElement(\"div\",{className:\"block-sms-ded\"},e.text,/*#__PURE__*/React.createElement(\"div\",{className:\"hide-time\"},\"\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\",e.time)),/*#__PURE__*/React.createElement(\"div\",{className:\"block-sms-info-time\"},e.time.substr(0,5)))):null,e.type===2?/*#__PURE__*/React.createElement(\"div\",{className:\"ded-messenge isxod-left\"},/*#__PURE__*/React.createElement(\"div\",{className:\"testmes ded-isxod\"},/*#__PURE__*/React.createElement(\"div\",{className:\"block-sms-ded\"},e.text,/*#__PURE__*/React.createElement(\"div\",{className:\"hide-time\"},\"\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\",e.time)),/*#__PURE__*/React.createElement(\"div\",{className:\"block-sms-info-time\"},e.time.substr(0,5)))):null,i===_this4.state.chat.message.length-1?/*#__PURE__*/React.createElement(\"div\",{className:\"ded-meta-center\"},/*#__PURE__*/React.createElement(\"div\",{className:\"dedmeta-text\"},e.date)):null,i<_this4.state.chat.message.length-1&&e.date.substring(6,10)+e.date.substring(3,5)+e.date.substring(0,2)>_this4.state.chat.message[i+1].date.substring(6,10)+_this4.state.chat.message[i+1].date.substring(3,5)+_this4.state.chat.message[i+1].date.substring(0,2)?/*#__PURE__*/React.createElement(\"div\",{className:\"ded-meta-center\"},/*#__PURE__*/React.createElement(\"div\",{className:\"dedmeta-text\"},e.date)):null);})),/*#__PURE__*/React.createElement(\"div\",{className:\"ded-input-text\"},/*#__PURE__*/React.createElement(MaterialIcon,{icon:\"insert_emoticon\",size:22,color:\"#7D8B97\"}),/*#__PURE__*/React.createElement(\"input\",{type:\"text\",placeholder:\"\\u012Eveskite \\u017Einut\\u0119...\",className:\"ded-text-ipn\",value:this.state.text,onBlur:function onBlur(e){return _this4.inputBlur(e);},onFocus:function onFocus(e){return _this4.inputFocus(e);},onChange:function onChange(e){return _this4.inputChange(e);}}),/*#__PURE__*/React.createElement(MaterialIcon,{icon:\"send\",size:22,color:\"#67B1F8\",onClick:function onClick(){return _this4.sendMessage();}}))));}}]);return Chat;}(React.Component);export default Chat;","map":{"version":3,"sources":["C:/Users/Skaidrius/Downloads/ragemppro_dednet/STATE-RAGE-UI-master-fixed/src/components/phone/components/apps/Chat.jsx"],"names":["React","MaterialIcon","Avatar","Chat","props","handleKeyPress","event","key","sendMessage","state","text","message_timeout","render","error","errorInfo","mp","trigger","prevProp","prevState","data","updateChat","window","scrollTo","document","body","scrollHeight","addEventListener","removeEventListener","setState","chat","contact","forEach","e","phone_number","messenger","current_chat","getContactByNumber","message","sort","a","b","date","time","is_online","last_login","target","value","toString","length","focus","setTimeout","bind","substr","prev","type","concat","height","setLink","name","substring","online","deleteChat","map","i","index","inputBlur","inputFocus","inputChange","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport MaterialIcon from 'material-icons-react';\n\nimport Avatar from '@material-ui/core/Avatar';\n\nclass Chat extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            text: '',\n            message_timeout: false,\n            render: false\n        }\n    }\n\n    componentDidCatch(error, errorInfo) {\n        mp.trigger('client:ui:debug', 'Chat.jsx', error, errorInfo); // eslint-disable-line\n    }\n\n    handleKeyPress = (event) => {\n        if (event.key === 'Enter') {\n            this.sendMessage();\n        }\n    }\n\n    componentDidUpdate(prevProp, prevState) {\n        if (this.props.data !== prevProp.data) {\n            this.updateChat();\n            window.scrollTo(0,document.body.scrollHeight);\n        }\n    }\n\n    componentWillMount() {\n        document.addEventListener(\"keydown\", this.handleKeyPress);\n        this.updateChat();\n        window.scrollTo(0,document.body.scrollHeight);\n    }\n\n    componentWillUnmount() {\n        document.removeEventListener(\"keydown\", this.handleKeyPress);\n        this.setState({ chat: {}, render: false, contact: null })\n    }\n\n    updateChat(){\n        let chat = null;\n        this.props.data.forEach((e) => {\n            if (e.phone_number === this.props.messenger.current_chat) {\n                chat = e;\n            }\n        })\n        if (chat != null) {\n            this.setState({\n                chat: chat,\n                render: true,\n                contact: this.props.getContactByNumber(chat.phone_number)\n            }, () => this.setState(prevState => ({\n                ...prevState.chat.message = [...this.state.chat.message]\n                    .sort(\n                        function (a, b) {\n                            if (a.date === b.date) {\n                                return b.time > a.time;\n                            }\n                            return a.date < b.date ? 1 : -1;\n                        })\n            })))\n        } else {\n            this.setState({\n                chat: {\n                    phone_number: this.props.messenger.current_chat,\n                    is_online: false, // был(а) в сети 12.01.2019\n                    last_login: '',\n                    message: []\n                },\n                render: true,\n                contact: this.props.getContactByNumber(this.props.messenger.current_chat)\n            })\n        }\n    }\n\n    inputChange(message) {\n        if (message.target.value.toString().length >= 500) return; // Макс длинна сообщения 600 символов\n        this.setState({ text: message.target.value })\n    }\n\n    inputFocus(focus) {\n        try {\n            mp.trigger('client:phone:inputModal', true); // eslint-disable-line\n        } catch (e) {\n        }\n    }\n\n    inputBlur(focus) {\n        try {\n            mp.trigger('client:phone:inputModal', false); // eslint-disable-line\n        } catch (e) {\n        }\n    }\n\n    sendMessage() {\n        if (this.state.message_timeout) return; // Нельзя отправлять сообщения так часто\n        this.setState({ message_timeout: true });\n        setTimeout(function () {\n            this.setState({ message_timeout: false })\n        }.bind(this), 1000); // 1 секунда таймаут на отправку сообщения\n        if (this.state.text.length >= 500)\n            this.setState({ text: this.state.text.substr(0, 500) }); // Макс длинна сообщения 500 символов\n        if (this.state.text === \"\")\n            return;\n\n        let text = this.state.text;\n\n        this.setState(prev => ({\n            ...prev.chat.message = [{\n                type: 2,\n                text: text,\n                time: this.props.time,\n                date: this.props.date,\n            }].concat(this.state.chat.message)\n        }), () => {\n            this.props.sendMessage(this.props.messenger.current_chat, this.state.chat, text);\n\n            try {\n                mp.trigger('client:phone:sendMessage', this.props.messenger.current_chat, this.state.chat, text); // eslint-disable-line\n            } catch (e) {\n            }\n        });\n        this.setState({ text: '' });\n    }\n\n    render() {\n        if (!this.state.render) return null;\n        return (\n            <React.Fragment>\n                <div className=\"dedbit-menu\">\n                    <div className=\"u-title\" style={{ height: 50 + 'px' }}>\n                        <div className=\"dedbit-u-texttittle\">\n                            <img src={`https://state-99.com/client/images/icons/components/phone/img/back.svg`} className=\"u__back-nabs\" height=\"16\" onClick={() => this.props.setLink(\"/phone/android/messenger\")} />\n                            {this.state.contact === null ?\n                                null\n                                :\n                                <span className=\"dedbit__messenger__chatname\">\n                                    {this.state.contact.name.substring(0, 1)}\n                                </span>\n                            }\n                            <div className=\"u-title-row spiceal-ts-chat\">\n                                <div\n                                    className=\"dedbit-title-name\">{this.state.contact !== null ? this.state.contact.name : this.state.chat.phone_number}</div>\n                                <div className=\"dedbit-title-text\">{this.state.chat.online}</div>\n                            </div>\n                            <div className=\"posit-icon-del-chat\" onClick={() => this.props.deleteChat(this.state.chat.phone_number) /* this.props.openModal('','Вы уверены в том что хотите удалить всю переписку?', ['Да','Нет'], 'params') */}>\n                            <MaterialIcon icon=\"delete\" size={18} color=\"#fff\"/>\n                            </div>                            \n                        </div>\n                    </div>\n                    <div className=\"messenger-main clm-reverse-chat\">\n                        {this.state.chat.message.map((e, i) => {\n                            let index = `dedchat${i}`\n                            return (\n                                <React.Fragment key={index}>\n                                    {e.type === 1 ?\n                                        <div className=\"ded-messenge\">\n                                            <div className=\"testmes ded-vxod\">\n                                                <div className=\"block-sms-ded\">{e.text}\n                                                    <div\n                                                        className=\"hide-time\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{e.time}</div>\n                                                </div>\n                                                <div className=\"block-sms-info-time\">{e.time.substr(0, 5)}</div>\n                                            </div>\n                                        </div>\n                                        : null}\n                                    {e.type === 2 ?\n                                        <div className=\"ded-messenge isxod-left\">\n                                            <div className=\"testmes ded-isxod\">\n                                                <div className=\"block-sms-ded\">{e.text}\n                                                    <div\n                                                        className=\"hide-time\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{e.time}</div>\n                                                </div>\n                                                <div className=\"block-sms-info-time\">{e.time.substr(0, 5)}</div>\n                                            </div>\n                                        </div>\n                                        : null}\n                                    {i === this.state.chat.message.length - 1 ?\n                                        <div className=\"ded-meta-center\">\n                                            <div className=\"dedmeta-text\">{e.date}</div>\n                                        </div>\n                                        : null}\n                                    {i < this.state.chat.message.length - 1 && \n                                    e.date.substring(6, 10) +\n                                    e.date.substring(3, 5)  +\n                                    e.date.substring(0, 2)  > \n                                    this.state.chat.message[i + 1].date.substring(6, 10) +\n                                    this.state.chat.message[i + 1].date.substring(3, 5) +\n                                    this.state.chat.message[i + 1].date.substring(0, 2) ?\n                                        <div className=\"ded-meta-center\">\n                                            <div className=\"dedmeta-text\">{e.date}</div>\n                                        </div>\n                                        : null}\n                                </React.Fragment>\n                            )\n                        })}\n                    </div>\n                    <div className=\"ded-input-text\">\n                        <MaterialIcon icon=\"insert_emoticon\" size={22} color=\"#7D8B97\" />\n                        <input type=\"text\" placeholder=\"Įveskite žinutę...\" className=\"ded-text-ipn\"\n                            value={this.state.text} onBlur={(e) => this.inputBlur(e)} onFocus={(e) => this.inputFocus(e)} onChange={(e) => this.inputChange(e)} />\n                        <MaterialIcon icon=\"send\" size={22} color=\"#67B1F8\" onClick={() => this.sendMessage()} />\n                    </div>\n                </div>\n            </React.Fragment>\n        )\n    }\n}\n\nexport default Chat;\n"]},"metadata":{},"sourceType":"module"}